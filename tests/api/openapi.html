<!DOCTYPE html>
<html>
<head>
	<title>yunNet. auth test</title>
	<script type="text/javascript" src="https://dev.yunnet.ru/js/oapi.js"></script>

	<meta charset="utf-8">
</head>
<body>
	<script type="text/javascript">
		window.addEventListener('DOMContentLoaded', function () {
			let session = Unt.Auth().init({app_id: 11});
			if (session.isLogged()) {
				let user = session.getCurrentUser();

				authCheckWindow.innerHTML = 'Пользователь авторизован как: <b>' + (user.name || (user.first_name + ' ' + user.last_name)) + '</b><br><br>'
											+ 'yunNet: <a href="https://yunnet.ru/' + (user.screen_name ? user.screen_name : (user.user_id ? ("id" + user.user_id) : ("bot" + user.bot_id))) + '">' + (user.name || (user.first_name + ' ' + user.last_name)) + '</a>';
				someAction.innerHTML = 'Выйти?';
				someAction.addEventListener('click', function () {
					session.endSession();

					return window.location.reload();
				});
			} else {
				authCheckWindow.innerHTML = 'Пользователь не авторизован!';
				someAction.innerHTML = 'Войти!';

				someAction.addEventListener('click', function () {
					someAction.setAttribute('disabled', 'true');
					authCheckWindow.innerHTML = 'Ждём выполнение входа...';

					session.getCurrentToken().then(function (token) {
						authCheckWindow.innerHTML = 'Пользователь авторизован...';

						setTimeout(function () {
							return window.location.reload();
						}, 1000);
					}).catch(function (error) {
						authCheckWindow.innerHTML = 'Пользователь не авторизован! Произошла ошибка.';
						someAction.removeAttribute('disabled');
						someAction.innerHTML = 'Повторить';
					});
				});
			}
		});
	</script>
	<div id="authCheckWindow" style="width: 250px; height: 200px color: blue;">
		Проверка авторизации пользователя...
	</div>
	<br>
	<button id="someAction">Жду...</button>
</body>
</html>
window.addEventListener("message",function(e){window.sentData=e.data});const settings={widgets:{auth:{init:function(){document.title="yunNet. Auth",settings.users.current||(document.body.style="background: #e0f2f1 !important"),document.body.innerHTML="",ui.isMobile()?document.body.innerHTML='<div id="menu"></div>':document.body.innerHTML='<div class="row"><div class="col s3"></div><div class="col s6"></div><div class="col s3"></div></div>';let e=(new URLParser).parse(),t=pages.elements.menuBody(),n=document.createElement("div");n.style.textAlign="-webkit-center",n.style.padding="25px",t.appendChild(n);let r=document.createElement("img");r.src="/favicon.ico",r.classList.add("circle"),r.style.cursor="pointer",r.width=r.height=96,n.appendChild(r),window.opener||e.returns||r.addEventListener("click",function(){return pages.elements.confirm("",settings.lang.getValue("return_to_auth"),function(e){if(e)return window.location.reload()})});let s=document.createElement("div");s.classList.add("card"),s.classList.add("full_section");let i=pages.elements.getLoader();s.appendChild(i),t.appendChild(s);let a=document.createElement("div");if(a.classList.add("full_section"),s.appendChild(a),!e.app_id)return a.innerText=settings.lang.getValue("app_id_is_invalid"),i.hide();dev.apps.getById(e.app_id).then(function(t){a.style.display="none";let n=document.createElement("div");if(s.appendChild(n),n.style.padding="10px",settings.users.current){n.innerText=settings.lang.getValue("app_requests").replace("%username%",settings.users.current.first_name+" "+settings.users.current.last_name).replace("%app_name%",t.title);let r=String(e.permissions||"").split(",");r.length>4&&(r.length=4),1===r.length&&""===r[0]&&(r=[]);let i=document.createElement("div");if(s.appendChild(i),i.style.padding="10px",r.length>0){i.innerText=settings.lang.getValue("permissions_needed");let e=document.createElement("div");e.classList.add("collection"),s.appendChild(e),e.style.padding="10px",r.forEach(function(t){let n=Number(t);if(isNaN(n)||n>4||n<1)return;let r=document.createElement("a");switch(r.classList.add("collection-item"),e.appendChild(r),n){case 1:r.innerText=settings.lang.getValue("friends");break;case 2:r.innerText=settings.lang.getValue("messages");break;case 3:r.innerText=settings.lang.getValue("settings");break;case 4:r.innerText=settings.lang.getValue("management")}})}else i.innerText=settings.lang.getValue("permissions_not_get");let a=document.createElement("div");a.classList.add("valign-wrapper"),s.appendChild(a),a.style.justifyContent="flex-end";let o=pages.elements.getLoader();o.style.display="none",o.style.marginLeft="20px";let u=!1,d=pages.elements.createFAB(unt.Icon.LOGOUT,function(){if(!u)return settings.Logout(1)}),l=pages.elements.createFAB(unt.Icon.CLOSE,function(){if(u)return;s.innerHTML="";let t=document.createElement("div");if(t.classList.add("full_section"),s.appendChild(t),s.innerText=settings.lang.getValue("access_denied"),window.opener&&e.returns)return window.opener.postMessage({status:-1},"*");if(decodeURIComponent(e.redirect_url)&&String(decodeURIComponent(e.redirect_url)).isURL()){let t=decodeURIComponent(e.redirect_url),n="?";return t.split("?").length>1&&(n="&"),t.startsWith("http://")||t.startsWith("https://")||(t="http://"+t),t+=n+"result=0&time="+Math.floor(new Date/1e3),setTimeout(function(){return window.location.href=t},1e3)}return s.innerText+="\n\n"+settings.lang.getValue("redirect_url_not_given")}),c=pages.elements.createFAB(unt.Icon.SAVE,function(){if(!u)return u=!0,d.classList.add("scale-out"),l.classList.add("scale-out"),o.style.display="",c.style.display="none",dev.auth.agree(Number(e.app_id)||0,r).then(function(t){u=!1,d.classList.remove("scale-out"),l.classList.remove("scale-out"),o.style.display="none",c.style.display="",s.innerHTML="";let n=document.createElement("div");if(n.classList.add("full_section"),s.appendChild(n),s.innerText=settings.lang.getValue("access_granted"),window.opener&&e.returns)return window.opener.postMessage({status:1,token:t.token,tokenId:t.id,user:settings.users.current},"*");if(decodeURIComponent(e.redirect_url)&&String(decodeURIComponent(e.redirect_url)).isURL()){let n=decodeURIComponent(e.redirect_url),r="?";return n.split("?").length>1&&(r="&"),n.startsWith("http://")||n.startsWith("https://")||(n="http://"+n),n+=r+"result=1&time="+Math.floor(new Date/1e3)+"&access_key="+t.token+"&token_id="+t.id+"&user_id="+settings.users.current.user_id,setTimeout(function(){return window.location.href=n},1e3)}{s.innerText+="\n\n"+settings.lang.getValue("redirect_url_not_given")+"\n\n";let e=pages.elements.createInputField("access_key",!0).setType("text");s.appendChild(e),e.getInput().setAttribute("readonly","true"),e.getInput().value=t.token;let n=pages.elements.createInputField("token_id",!0).setType("number");s.appendChild(n),n.getInput().setAttribute("readonly","true"),n.getInput().value=t.id;let r=pages.elements.createInputField("user_id",!0).setType("number");s.appendChild(r),r.getInput().setAttribute("readonly","true"),r.getInput().value=settings.users.current.user_id}}).catch(function(e){return u=!1,d.classList.remove("scale-out"),l.classList.remove("scale-out"),o.style.display="none",c.style.display="",unt.toast({html:settings.lang.getValue("upload_error")})})});d.classList.remove("fixed-action-btn"),l.classList.remove("fixed-action-btn"),l.style.marginLeft="20px",c.classList.remove("fixed-action-btn"),c.style.marginLeft="20px",d.classList.add("scale-transition"),c.classList.add("scale-transition"),l.classList.add("scale-transition"),a.appendChild(d),a.appendChild(l),a.appendChild(o),a.appendChild(c)}else{n.innerText=settings.lang.getValue("for_app_auth").replace("%app_name%",t.title);let e=pages.elements.createInputField(settings.lang.getValue("login")),r=pages.elements.createInputField(settings.lang.getValue("password")),i=document.createElement("form");i.style.padding="5px",s.appendChild(i);let a=document.createElement("div");i.appendChild(a),a.classList=["collection incorrect_message"],a.style.display="none";let o=document.createElement("a");a.appendChild(o),o.classList.add("collection-item"),o.style="background-color: #42a5f5 !important; color: white; margin-left: 3% !important; margin-right: 3% !important",o.innerHTML=settings.lang.getValue("incorrect_login"),r.setType("password"),e.setType("email"),i.appendChild(e),i.appendChild(r);let u=document.createElement("div");i.appendChild(u),u.classList.add("center");let d=document.createElement("button");d.action="submit",i.onsubmit=function(e){return e.preventDefault()},u.appendChild(d),d.style.backgroundColor="#64b5f6 !important",d.classList=["btn modal-trigger waves-effect btn-large waves-light"];let l=document.createElement("div");d.appendChild(l),l.id="auth_text";let c=document.createElement("t");l.appendChild(c),c.innerText=settings.lang.getValue("logstart");let p=document.createElement("i");l.appendChild(p),p.innerHTML='<svg style="fill: white" class="unt_icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg>',p.classList.add("right"),p.style.marginTop="3px";let g=document.createElement("div");d.appendChild(g),g.style="display: none; margin-top: 20%",g.id="auth_loader";let m=document.createElement("div");g.appendChild(m),m.innerHTML='<svg width="40" height="40" viewBox="0 0 50 50"><path fill="white" transform="rotate(61.2513 25 25)" d="M25,5A20.14,20.14,0,0,1,45,22.88a2.51,2.51,0,0,0,2.49,2.26h0A2.52,2.52,0,0,0,50,22.33a25.14,25.14,0,0,0-50,0,2.52,2.52,0,0,0,2.5,2.81h0A2.51,2.51,0,0,0,5,22.88,20.14,20.14,0,0,1,25,5Z" fill="#42a5f5"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.4s" repeatCount="indefinite"></animateTransform></path></svg>',d.onclick=function(t){return account.auth(d,t,e.getInput(),r.getInput())},i.appendChild(document.createElement("br"));let f=document.createElement("div");i.appendChild(f),f.classList.add("center");let h=document.createElement("a");f.appendChild(h),h.style.cursor="pointer",h.innerText=settings.lang.getValue("regstart"),h.onclick=function(e){return e.preventDefault(),pages.elements.alert(settings.lang.getValue("after_registration")).then(function(e){return pages.elements.confirm("",settings.lang.getValue("reg_privacy_warning"),function(e){if(e){let e=window.open("/register","yunNet.","resizable,scrollbars,status"),t=!1;e&&window.addEventListener("message",function(n){if("success"===n.data)return window.location.refresh(),e.close();if("cancelled"===n.data){if(t)return;return t=!0,pages.elements.alert(settings.lang.getValue("register_cancel")),e.close()}})}})})},ui.bindItems()}return i.hide()}).catch(function(e){return a.innerText=settings.lang.getValue("app_is_invalid"),i.hide()})}}},audio:new Audio("https://dev.yunnet.ru/sounds/message.wav"),playCurrentSound:function(){this.audio.currentTime=0,this.audio.play()},getCounters:function(){let e=settings.getCounters.current;return new Promise(function(t,n){if(!settings.users.current)return t(new TypeError("Unauthorized!"));if("object"==typeof e)return t(e);let r=new FormData;return r.append("action","get_counters"),ui.Request({url:"/flex",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).unauth?settings.reLogin():e.error?n(new TypeError("Unable to fetch counters")):t(settings.getCounters.current=e)}})})},accounts:{unbound:function(e=1){return new Promise(function(t,n){let r=new FormData;return r.append("action","unbound_account"),r.append("type",Number(e)),ui.Request({url:"/audios",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Accounts fetching failed")):t(!0)}})})},get:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","get_accounts"),ui.Request({url:"/settings",data:n,method:"POST",success:function(n){return(n=JSON.parse(n)).error?t(new TypeError("Accounts fetching failed")):e(n.response)}})})},auth:function(e,t,n,r=null){return new Promise(function(s,i){let a=new FormData;return a.append("action","bound_account"),a.append("type",n),a.append("login",e),a.append("password",t),r&&a.append("auth_code",Number(r)),ui.Request({url:"/audios",data:a,method:"POST",success:function(e){return e=JSON.parse(e),s(e)}})})}},reLogin:function(){return this.isLogged=!1,settings.Logout()},Logout:function(e){if(e)return pages.elements.confirm("",settings.lang.getValue("logout_qq"),function(e){if(e)return settings.Logout()});if(document.getElementById("logout"))return null;if(!settings.users.current)return null;let t=pages.elements.getLoader(),n=document.createElement("div");n.id="logout",n.classList.add("modal"),ui.isMobile()&&n.classList.add("bottom-sheet"),document.body.appendChild(n);let r=unt.Modal.init(n,{endingTop:"40%",dismissible:!1,onCloseEnd:function(){n.remove()}}),s=document.createElement("div");s.classList.add("modal-content"),n.appendChild(s);let i=document.createElement("div");i.classList.add("valign-wrapper"),s.appendChild(i),i.appendChild(t),t.classList.remove("center");let a=document.createElement("div");return i.appendChild(a),a.style.marginLeft="15px",a.innerText="Logging out...",r&&r.open(),setTimeout(function(){document.cookie="";let e=new FormData;e.append("action","logout");let t=_xmlHttpGet();return t.open("POST","/settings"),t.withCredentials=!0,t.onreadystatechange=function(){if(4===t.readyState)return window.location.reload()},t.send(e)},1e3)},lang:{values:{},change:function(e){let t=new FormData;return t.append("action","change_language"),t.append("lang",String(e).toLowerCase()),new Promise(function(e,n){return ui.Request({url:"/settings",method:"POST",data:t,success:function(){return settings.lang.values={},e(window.location.reload())}})})},getValue:function(e){return settings.lang.values[e]||""}},users:{profiles:{},setGender:function(e){return new Promise(function(t,n){if(1!==e&&2!==e)return n(new TypeError("Gender can be only male or female"));let r=new FormData;return r.append("action","set_gender"),r.append("gender",Number(e)||0),ui.Request({data:r,url:"/settings",method:"POST",success:function(e){return(e=JSON.parse(e)).unauth?settings.reLogin():e.error?n(new TypeError("Unable to change gender")):t(e.success)}})})},openWindow:function(e){return new Promise(function(t){return settings.users.resolveScreenName(e).then(function(e){let n=pages.elements.createWindow(),r=n.getContent(),s=n.getFooter(),i=document.createElement("a");i.style.cursor="pointer",i.classList=["btn btn-flat waves-effect"],i.innerText=settings.lang.getValue("go_to_the_profile"),i.setAttribute("target","_blank"),i.setAttribute("href","/"+(e.screen_name?e.screen_name:e.user_id?"id"+e.user_id:"bot"+e.bot_id)),s.appendChild(i);let a=document.createElement("div");a.classList.add("valign-wrapper"),r.appendChild(a);let o=document.createElement("img");o.style.marginRight="15px",o.classList.add("circle"),o.width=o.height=64,o.src=e.photo_url,a.appendChild(o);let u=document.createElement("div");a.appendChild(u);let d=document.createElement("b");u.appendChild(d),d.innerText=e.name||e.first_name+" "+e.last_name,u.appendChild(document.createElement("br"));let l=document.createElement("small");l.style.color="gray",u.appendChild(l),l.innerText=pages.parsers.getOnlineState(e);let c=document.createElement("div");if(r.appendChild(c),2===e.friend_state){c.appendChild(document.createElement("br"));let e=document.createElement("div");e.classList.add("valign-wrapper"),c.appendChild(e);let t=document.createElement("div");t.innerHTML=unt.Icon.SAVE,e.appendChild(t),t.style.marginTop="5px",t.style.marginRight="5px";let n=document.createElement("div");n.innerText=settings.lang.getValue("in_friends_now"),e.appendChild(n)}return t(n)}).catch(function(e){return t(null)})})},setStatus:function(e=""){return new Promise(function(t,n){let r=new FormData;return r.append("action","set_status"),r.append("new_status",String(e)),ui.Request({data:r,url:"/flex",method:"POST",success:function(e){return(e=JSON.parse(e)).unauth?settings.reLogin():e.error?n(new TypeError("Unable to change status")):t(e.status)}})})},search:function(e="",t={},n=0,r=30){return new Promise(function(s,i){if("string"!=typeof e||e.isEmpty())return i(new TypeError("Query is invalid"));let a=new FormData;return a.append("action","search"),a.append("query",e.toString()),a.append("offset",Number(n)||0),a.append("count",Number(r)||30),t.onlineOnly&&a.append("online_only","1"),t.searchBots&&a.append("search_bots","1"),t.searchBotsOnly&&a.append("only_bots","1"),ui.Request({data:a,url:"/friends",method:"POST",success:function(e){return(e=JSON.parse(e)).error?rejct(new TypeError("Unable to search")):s(e)}})})},changePassword:function(e,t){return new Promise(function(n,r){let s=new FormData;return s.append("action","change_password"),s.append("old_password",e),s.append("new_password",t),ui.Request({data:s,url:"/settings",method:"POST",success:function(e){return(e=JSON.parse(e)).error?r(new TypeError("Password check failed")):n(Boolean(e.state))}})})},verifyPassword:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","verify_password"),r.append("password",e),ui.Request({url:"/settings",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Password check failed")):t(Boolean(e.state))}})})},getBlacklisted:function(e=1){return new Promise(function(t,n){let r=30*(e-1),s=new FormData;return s.append("action","get_blacklisted"),s.append("offset",r),s.append("count",30),ui.Request({url:"/settings",data:s,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Blacklist fetch error")):t(e)}})})},get:function(e,t="name_cases,bot_can_write_messages,can_write_messages,main_photo_as_object,can_access_closed,can_write_on_wall,friend_state,is_me_blacklisted,is_blacklisted,can_invite_to_chat"){return new Promise(function(n,r){if(settings.users.profiles[e])return n(settings.users.profiles[e]);let s=new FormData;return s.append("action","get_user_data"),s.append("fields",String(t)),s.append("id",String(e)),ui.Request({method:"POST",url:"/flex",data:s,success:function(e){return(e=JSON.parse(e)).error?r(new TypeError("User not found")):e.response?n(settings.users.profiles[Number(e.response.user_id||-1*e.response.bot_id)]=e.response):void 0}})})},resolveScreenName:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","get_user_data_by_link"),r.append("screen_name",String(e)),ui.Request({method:"POST",url:"/flex",data:r,success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("User not found")):e.id?(delete settings.users.profiles[e.id],settings.users.get(e.id).then(t).catch(n)):void 0}})})},edit:function(e){return new Promise(function(t,n){let r=["first_name","last_name","screen_name","photo"],s=new FormData;s.append("action","save");for(let t in e)-1!==r.indexOf(t)&&s.append(t,e[t]||"");return ui.Request({url:"/edit",data:s,method:"POST",success:function(e){try{if((e=JSON.parse(e)).error){let t=new Error("Edit failed");return e.message&&(t.errorMessage=e.message),n(t)}return t(e)}catch(e){return n(new Error("Edit failed"))}}})})},friends:{acceptRequest:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","add"),ui.Request({data:r,method:"POST",url:"/id"+(Number(e)||1),success:function(e){return t(!0)}})})},hideRequest:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","hide_request"),r.append("user_id",Number(e)||0),ui.Request({url:"/friends",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Unable to hide request")):t(e.success)}})})},cache:{},get:function(e,t="friends",n=1){return new Promise(function(r,s){if(settings.users.current.user_id===e&&settings.users.friends.cache[t]&&1===n)return r(settings.users.friends.cache[t]);let i=new FormData;return i.append("action","get_friends"),i.append("user_id",e),i.append("section",t),i.append("offset",30*(Number(n)-1)),ui.Request({data:i,url:"/flex",method:"POST",success:function(i){return(i=JSON.parse(i)).unauth?settings.reLogin():i.error?s(new Error("Friends fetch error")):(settings.users.current.user_id===e&&1===n&&(settings.users.friends.cache[t]=i),r(i))}})})}}},get:function(e=!1){return e?new Promise(function(e,t){if(settings.currentSettings)return e(settings.currentSettings);let n=new FormData;return n.append("action","get_settings"),ui.Request({url:"/flex",data:n,method:"POST",success:function(n){return(n=JSON.parse(n)).unauth?settings.reLogin():n.error?t(new TypeError("Settings resolving failed")):e(settings.currentSettings=n)}})}):settings.currentSettings},data:{endSession:function(e){return new Promise(function(t,n){if(!e)return n(new TypeError("Session id must be provided"));if(e.toString().isEmpty())return n(new TypeError("Session id must be not empty"));let r=new FormData;return r.append("action","end_session"),r.append("session_id",String(e)),ui.Request({data:r,method:"POST",url:"/settings",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Unable to fetch the sessions list")):e.unauth?settings.reLogin():t(e.success)}})})},getSessions:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","get_sessions_list"),ui.Request({data:n,method:"POST",url:"/settings",success:function(n){return(n=JSON.parse(n)).error?t(new TypeError("Unable to fetch the sessions list")):n.unauth?settings.reLogin():e(n)}})})},toggleSoundSettings:function(e){if(e<1||e>2)return!1;let t=["notifications","sound"][e-1];return new Promise(function(e,n){let r=new FormData;return r.append("action","toggle_push_settings"),r.append("settings_group",t),r.append("new_value",Number(!settings.get().push[t])),ui.Request({data:r,url:"/settings",method:"POST",success:function(r){return(r=JSON.parse(r)).error?n(new TypeError("Settings changing error")):(settings.get().push[t]=r.response,e(r.response))}})})},toggleNotifications:function(){return this.toggleSoundSettings(1)},toggleSound:function(){return this.toggleSoundSettings(2)},toggleProfileState:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","toggle_profile_state"),ui.Request({url:"/settings",data:n,method:"POST",success:function(n){return(n=JSON.parse(n)).unauth?settings.reLogin():n.error?t(new TypeError("Settings changing failed")):(settings.get().account.is_closed=!settings.get().account.is_closed,e(settings.get().account.is_closed))}})})},setPrivacy:function(e,t){let n=["can_write_messages","can_write_on_wall","can_invite_to_chats","can_comment_posts"][Number(e)-1];return!!n&&(!isNaN(Number(t))&&(!(Number(t)<0||Number(t)>2)&&new Promise(function(r,s){let i=new FormData;return i.append("action","set_privacy_settings"),i.append("group",Number(e)),i.append("value",Number(t)),ui.Request({url:"/settings",data:i,method:"POST",success:function(e){return(e=JSON.parse(e)).unauth?settings.reLogin():e.error?s(new TypeError("Settings changing failed")):(void 0!==settings.get().privacy[n]&&(settings.get().privacy[n]=Number(t)),r(!0))}})})))},test:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","test"),ui.Request({data:n,method:"POST",url:"/flex",success:function(t){try{return(t=JSON.parse(t)).unauth?settings.reLogin():t.blocked?e(settings.data.test.isBlocked=!0):e(!1)}catch(t){return e(null)}}})})}},currentSettings:null,getStats:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","get_stats"),ui.Request({url:"/about",method:"POST",data:n,success:function(n){return(n=JSON.parse(n)).error?t(new TypeError("Unable to get yunNet. stats")):e(n)}})})}},account={user:{},restore:{closeSession:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","close_session"),ui.Request({url:"/restore",data:n,method:"POST",success:function(t){return e()}})})},validateQuery:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","check_query"),r.append("query",String(e)),ui.Request({url:"/restore",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).stage?t(e.stage):t(null)}})})},getCurrentStage:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","get_state"),ui.Request({url:"/restore",data:n,method:"POST",success:function(t){try{return(t=JSON.parse(t)).state?e(t.state):e(0)}catch(t){return e(1)}}})})},sendSessionData:function(e){return new Promise(function(t,n){return e.append("action","continue"),ui.Request({url:"/restore",method:"POST",data:e,success:function(e){try{if(!(e=JSON.parse(e)).stage){let t=new Error("Data send error");return t.errorCode=e.error_code,e.error_message&&(t.errorText=e.error_message),e.new_stage&&(t.requestedStage=e.new_stage),n(t)}return t(e.stage)}catch(e){return n(e)}}})})}},register:{restoreData:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","get_data"),ui.Request({url:"/register",data:n,method:"POST",success:function(t){return e(JSON.parse(t))}})})},closeSession:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","close_session"),ui.Request({url:"/register",data:n,method:"POST",success:function(t){return e()}})})},getCurrentStage:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","get_state"),ui.Request({url:"/register",data:n,method:"POST",success:function(t){try{return(t=JSON.parse(t)).closed?e(-1):t.state?e(t.state):e(0)}catch(t){return e(1)}}})})},sendSessionData:function(e){return new Promise(function(t,n){return e.append("action","continue"),ui.Request({url:"/register",method:"POST",data:e,success:function(e){try{if(!(e=JSON.parse(e)).stage){let t=new Error("Data send error");return t.errorCode=e.error_code,e.error_message&&(t.errorText=e.error_message),e.new_stage&&(t.requestedStage=e.new_stage),n(t)}return t(e.stage)}catch(e){return n(e)}}})})}},auth:function(e,t,n,r){t.preventDefault(),document.getElementsByClassName("incorrect_message")[0].style.display="none";let s=document.getElementById("login_field");s||(s=n);let i=document.getElementById("password_field");return i||(i=r),s.value.isEmpty()?s.classList.add("invalid"):i.value.isEmpty()?i.classList.add("invalid"):(auth_text.style.display="none",auth_loader.style.display="",void settings.users.get().then(function(e){return window.location.reload()}).catch(function(e){let t=new FormData;t.append("action","login"),t.append("email",String(s.value)),t.append("password",String(i.value));let n=_xmlHttpGet();n.withCredentials=!0,n.onreadystatechange=function(){if(4!==n.readyState)return;let e=n.responseText;return(e=JSON.parse(e)).error?(auth_text.style.display="",auth_loader.style.display="none",document.getElementsByClassName("incorrect_message")[0].style.display=""):e.success?window.location.reload():void 0},n.open("POST","/login"),n.send(t)}))}},uploads={type:{IMAGE:"image",THEME:"theme"},getURL:function(e=this.type.IMAGE){return new Promise(function(t,n){let r=new FormData;return r.append("action","get"),r.append("type",e),ui.Request({url:"/upload",method:"POST",data:r,success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("URL resolving error")):t(e.url)},error:function(e){return n(e)}})})},upload:function(e,t,n=null){return new Promise(function(r,s){let i=new FormData;i.append("attachment",t);let a=_xmlHttpGet();return a.onreadystatechange=function(){if(4!==a.readyState)return;if(200!==a.status&&301!==a.status&&302!==a.status&&300!==a.status)return s(new TypeError("Upload failed"));let e=a.responseText;return(e=JSON.parse(e)).error?s(new TypeError("Upload failed")):r(e)},n&&(a.upload.onprogress=function(e){return n(e)}),a.onerror=function(e){return s(e)},a.open("POST",e),a.send(i)})}},audios={current:null,repeatMode:1,shuffle:!1,audioIndex:[],audiosList:{},buildPlayerElement:function(e=!1){let t=document.createElement("div");if(t.classList=["card full_section"],e){t.classList.remove("full_section"),t.style.padding="10px",t.setup=function(){ui.isMobile()?(t.style.position="absolute",t.style.width="100%",t.style.bottom="7%",document.getElementsByClassName("sidenav")[0].appendChild(t)):document.getElementsByClassName("col s3")[0].appendChild(t)};let e=document.createElement("div");t.appendChild(e),e.classList.add("valign-wrapper");let n=document.createElement("a");n.href="#",n.style.marginTop="5px",e.appendChild(n),n.setIcon=function(e){return n.innerHTML=e,n},t.getControlButton=function(){return n},n.setIcon(unt.Icon.PLAY),n.onclick=function(e){return e.preventDefault(),audios.audiosList[audios.current].paused?audios.audiosList[audios.current].play():audios.audiosList[audios.current].pause()};let r=document.createElement("div");e.appendChild(r),r.classList.add("hidet"),t.setData=function(e){return r.innerText=e,t},audios.miniPlayerCreated=!0}else{let e=document.createElement("div");e.classList.add("valign-wrapper"),t.appendChild(e);let n=pages.elements.createFAB(unt.Icon.PLAY,function(e){return audios.audiosList[audios.current].paused?audios.audiosList[audios.current].play():audios.audiosList[audios.current].pause()});n.classList.remove("fixed-action-btn"),e.appendChild(n),t.getControlButton=function(){return n};let r=document.createElement("div");r.style.marginLeft="15px",e.appendChild(r);let s=document.createElement("b");r.appendChild(s);let i=document.createElement("div");i.classList.add("hidet"),r.appendChild(i),t.setTitle=function(e){s.innerText=e},t.setArtist=function(e){i.innerText=e};let a=document.createElement("form");t.appendChild(a);let o=document.createElement("p");o.classList.add("range-field"),a.appendChild(o);let u=document.createElement("input");o.appendChild(u),u.type="range",o.style.marginBottom="0px",u.setAttribute("min","0"),u.setAttribute("max","0"),t.getRange=function(){return o},o.getInput=function(){return u};let d=document.createElement("div");d.classList.add("valign-wrapper"),t.appendChild(d);let l=document.createElement("small");l.style.width="100%";let c=document.createElement("small");d.appendChild(l),d.appendChild(c),l.innerText="00:00",t.getMinTime=function(){return l},t.getMaxTime=function(){return c};let p=document.createElement("div");t.appendChild(p),p.classList.add("center");let g=document.createElement("a"),m=document.createElement("a"),f=document.createElement("a"),h=document.createElement("a");g.href="#",m.href="#",f.href="#",h.href="#",p.appendChild(g),p.appendChild(m),p.appendChild(f),p.appendChild(h),g.innerHTML=unt.Icon.REPEAT,m.innerHTML=unt.Icon.SKIP_PREV,f.innerHTML=unt.Icon.SKIP_NEXT,h.innerHTML=unt.Icon.SHUFFLE,2===audios.repeatMode&&(g.innerHTML=unt.Icon.REPEAT_ONE),audios.shuffle&&(h.getElementsByTagName("svg")[0].style.fill="lightgray"),g.onclick=function(e){e.preventDefault(),2===audios.repeatMode?(audios.repeatMode=1,g.innerHTML=unt.Icon.REPEAT):(audios.repeatMode=2,g.innerHTML=unt.Icon.REPEAT_ONE)},h.onclick=function(e){e.preventDefault(),audios.shuffle?(audios.shuffle=!1,h.getElementsByTagName("svg")[0].style.fill=""):(audios.shuffle=!0,h.getElementsByTagName("svg")[0].style.fill="lightgray")},m.onclick=function(e){return e.preventDefault(),audios.prev()},f.onclick=function(e){return e.preventDefault(),audios.next()}}return t},next:function(){if(!this.current)return!1;let e=this.audioIndex.indexOf(this.current);if(-1===e)return!1;let t=this.audioIndex[e+1];return t||(t=this.audioIndex[0]),!!t&&this.audiosList[t].play()},prev:function(){if(!this.current)return!1;let e=this.audioIndex.indexOf(this.current);if(-1===e)return!1;let t=this.audioIndex[e-1];return t||(t=this.audioIndex[this.audioIndex.length-1]),!!t&&this.audiosList[t].play()},playNext:function(e){let t=this.audioIndex.indexOf(e);if(-1===t)return!1;let n=this.audioIndex[t+1];if(audios.shuffle){let e=getRandomInt(0,this.audioIndex.length-1);n=this.audioIndex[e]}else n||1!==this.repeatMode||(n=this.audioIndex[0]),2===this.repeatMode&&(n=e);return!!n&&this.audiosList[n].play()},pauseAll:function(e){for(let t in this.audiosList)t!==e&&(this.audiosList[t].paused||(this.audiosList[t].currentTime=0,this.audiosList[t].pause()))},get:function(e,t=1,n=30){let r=(t-1)*n;return new Promise(function(t,s){let i=new FormData;return i.append("action","get_audio"),i.append("type",e),i.append("offset",r),i.append("count",Number(n)),ui.Request({url:"/audios",data:i,method:"POST",success:function(e){return(e=JSON.parse(e)).error?s(new TypeError("Audios fetch failed")):t(e.response)}})})}},notifications={cache:[],get:function(e,t){return new Promise(function(n,r){if(e<t&&notifications.cache.length>=t)return n(notifications.cache);e<0&&(e=0),t>100&&(t=100);let s=new FormData;return s.append("action","get_notifications"),s.append("offset",Number(e)),s.append("count",Number(t)),ui.Request({url:"/notifications",data:s,method:"POST",success:function(e){return(e=JSON.parse(e)).error?r(new TypeError("Unable to notifications fetch")):n(notifications.cache=e)}})})},getById:function(e){},read:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","notification_read"),r.append("notification_id",Number(e)),ui.Request({url:"/notifications",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Unable to read notification")):t(!0)}})})},hide:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","notification_hide"),r.append("notification_id",Number(e)),ui.Request({url:"/notifications",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Unable to hide notification")):t(!0)}})})}};
const codes={callbacks:{Settings:function(e,t,n,s,a){let l=settings.get();if(e===a[0]){t.appendChild(pages.elements.createButton(null,null,null,"black",[[unt.Icon.COOKIE,settings.lang.getValue("cookies")+": <b>"+l.account.balance.cookies+"</b>",new Function],[unt.Icon.BITE_COOKIE,settings.lang.getValue("half_cookies")+": <b>"+l.account.balance.half_cookies+"</b>",new Function],[unt.Icon.SETTINGS,settings.lang.getValue("cookies_manage"),function(){return ui.go("https://"+window.location.host+"/cookies")}]]));let e=pages.elements.createCollapsible([[unt.Icon.PLANET,settings.lang.getValue("languages")]]);t.appendChild(e);let n=e.getBody(0),s=document.createElement("div");n.appendChild(s),s.classList.add("collection");let a=document.createElement("a");a.classList.add("collection-item"),s.appendChild(a),a.innerText="Русский",a.onclick=function(){return settings.lang.change("ru")};let i=document.createElement("a");i.classList.add("collection-item"),s.appendChild(i),i.innerText="English",i.onclick=function(){return settings.lang.change("en")}}if(e===a[1]){let e=pages.elements.createSwitchButton([[unt.Icon.NOTIFICATIONS,settings.lang.getValue("notifications"),function(e,t){settings.data.toggleNotifications()}],[unt.Icon.SOUND,settings.lang.getValue("sound"),function(e,t){settings.data.toggleSound()}]]).selectItem(0,l.push.notifications).selectItem(1,l.push.sound);t.appendChild(e)}if(e===a[2]){let e=pages.elements.createCollapsible([[unt.Icon.MESSAGES,settings.lang.getValue("messages_privacy")],[unt.Icon.WALL,settings.lang.getValue("wall_privacy")],[unt.Icon.COMMENTS_INL,settings.lang.getValue("who_can_comment_my_posts")]]);t.appendChild(e),e.getBody(0).appendChild(pages.elements.createSelector("can_write_messages",[[settings.lang.getValue("all"),function(){settings.data.setPrivacy(1,0)}],[settings.lang.getValue("only_friends"),function(){settings.data.setPrivacy(1,1)}],[settings.lang.getValue("nobody"),function(){settings.data.setPrivacy(1,2)}]]).selectItem(l.privacy.can_write_messages)),e.getBody(1).appendChild(pages.elements.createSelector("can_write_on_wall",[[settings.lang.getValue("all"),function(){settings.data.setPrivacy(2,0)}],[settings.lang.getValue("only_friends"),function(){settings.data.setPrivacy(2,1)}],[settings.lang.getValue("nobody"),function(){settings.data.setPrivacy(2,2)}]]).selectItem(l.privacy.can_write_on_wall)),e.getBody(2).appendChild(pages.elements.createSelector("can_comment_posts",[[settings.lang.getValue("all"),function(){settings.data.setPrivacy(4,0)}],[settings.lang.getValue("only_friends"),function(){settings.data.setPrivacy(4,1)}],[settings.lang.getValue("nobody"),function(){settings.data.setPrivacy(4,2)}]]).selectItem(l.privacy.can_comment_posts));let n=pages.elements.createCollapsible([[unt.Icon.CHATS,settings.lang.getValue("chat_privacy")]]);t.appendChild(n),n.getBody(0).appendChild(pages.elements.createSelector("can_invite_to_chats",[[settings.lang.getValue("only_friends"),function(){settings.data.setPrivacy(3,0)}],[settings.lang.getValue("nobody"),function(){settings.data.setPrivacy(3,1)}]]).selectItem(l.privacy.can_invite_to_chats));let s=pages.elements.createSwitchButton([[unt.Icon.LOCKED,settings.lang.getValue("closed_profile"),function(e,t){return l.account.is_closed?settings.data.toggleProfileState():(s.selectItem(0,l.account.is_closed),pages.elements.confirm("",settings.lang.getValue("closed_profile_attention")+" "+settings.lang.getValue("continue")+"?",function(e){if(e)return s.selectItem(0,!0),settings.data.toggleProfileState()}))}]]).selectItem(0,l.account.is_closed);t.appendChild(s)}if(e===a[3]){let e=pages.elements.createButton(unt.Icon.FINGERPRINT,settings.lang.getValue("activity_history"),function(){return ui.go("https://"+window.location.host+"/sessions")});t.appendChild(e);let n=pages.elements.createCollapsible([[unt.Icon.LOCKED,settings.lang.getValue("change_password")]]),s=n.getBody(0),a=pages.elements.createInputField(settings.lang.getValue("current_password")).setType("password").maxLength(32),l=pages.elements.createInputField(settings.lang.getValue("new_password")).setType("password").maxLength(32),i=pages.elements.createInputField(settings.lang.getValue("repeat_password")).setType("password").maxLength(32);s.appendChild(a),s.appendChild(l),s.appendChild(i);let o=pages.elements.createFAB(unt.Icon.ARROW_FWD);o.classList.remove("fixed-action-btn"),o.style.textAlign="end";let d=o.getElementsByTagName("a")[0];s.appendChild(o),t.appendChild(n),d.classList.add("scale-transition"),d.classList.add("scale-out");let c=pages.elements.getLoader();s.appendChild(c),c.style.width="100%",c.style.textAlign="end",c.style.display="none",a.oninput=l.oninput=i.oninput=function(e){a.getValue().isEmpty()||l.getValue().isEmpty()||i.getValue().isEmpty()?d.classList.add("scale-out"):d.classList.remove("scale-out")},o.onclick=function(e){return l.getValue()!==i.getValue()?(l.getInput().classList.add("wrong"),i.getInput().classList.add("wrong")):(l.getInput().classList.remove("wrong"),i.getInput().classList.remove("wrong"),o.style.display="none",c.show(),a.getInput().classList.remove("wrong"),settings.users.verifyPassword(a.getValue()).then(function(e){return e?pages.elements.confirm("",settings.lang.getValue("change_password_warning"),function(e){if(e)return a.getInput().disabled=!0,l.getInput().disabled=!0,i.getInput().disabled=!0,settings.users.changePassword(a.getValue(),l.getValue()).then(function(e){if(!e)throw new TypeError("not changed!");return c.hide(),unt.toast({html:settings.lang.getValue("loading")}),setTimeout(function(){return window.location.reload()},1e3)}).catch(function(e){return a.getInput().disabled=!1,l.getInput().disabled=!1,i.getInput().disabled=!1,c.hide(),o.style.display="",unt.toast({html:settings.lang.getValue("upload_error")})});c.hide(),o.style.display=""}):(c.hide(),o.style.display="",a.getInput().classList.add("wrong"))}).catch(function(e){return c.hide(),o.style.display="",unt.toast({html:settings.lang.getValue("upload_error")})}))}}if(e===a[4]){let e=pages.elements.getLoader();e.style.marginTop="15px",t.appendChild(e);let n=document.createElement("div");return n.classList=["card collection"],t.appendChild(n),settings.users.getBlacklisted(1).then(function(s){if(s.length>0)s.forEach(function(e){let t=pages.elements.userItem(e);n.appendChild(t)});else{n.style.display="none";let e=pages.elements.alertWindow(unt.Icon.LIST,settings.lang.getValue("blacklist_empty"),settings.lang.getValue("blacklist_empty_text"));t.appendChild(e)}return ui.bindItems(),e.hide()}).catch(function(s){n.style.display="none";let a=pages.elements.uploadError();return t.appendChild(a),e.hide(),ui.bindItems()})}if(e===a[5]){let e=pages.elements.createButton(unt.Icon.INFO,settings.lang.getValue("see_bound_accounts"),new Function);t.appendChild(e);let n=pages.elements.getLoader();return t.appendChild(n),settings.accounts.get().then(function(e){n.hide();let s="VK ("+settings.lang.getValue("logged_as")+": "+e[0].first_name+" "+e[0].last_name+")";e[0].bound||(s="VK ("+settings.lang.getValue("not_logged")+")");let a=pages.elements.createCollapsible([[unt.Icon.CHATS,s,new Function]]),l=a.getBody(0),i=(a.getHeader(0),e[0]);t.appendChild(a);let o=document.createElement("div");if(o.classList.add("collection"),l.appendChild(o),i.bound){let n=document.createElement("a");n.classList.add("collection-item"),n.onclick=function(n){return subPages.accounts.VKManage(e[0],n,t)},n.innerText=settings.lang.getValue("edit"),o.appendChild(n)}else{let n=document.createElement("a");n.classList.add("collection-item"),n.onclick=function(n){return subPages.accounts.VKManage(e[0],n,t)},n.innerText=settings.lang.getValue("logstart"),o.appendChild(n)}return ui.bindItems(),unt.AutoInit()}).catch(function(e){let s=pages.elements.uploadError();return n.hide(),t.appendChild(s)})}if(e===a[6])return subPages.theming(t,s);e===a[7]&&(t.appendChild(pages.elements.createButton(unt.Icon.STATS,settings.lang.getValue("about"),function(){return ui.go("https://"+window.location.host+"/about")})),t.appendChild(pages.elements.createButton(unt.Icon.DEV,settings.lang.getValue("devs"),function(){return window.location.href="https://dev.yunnet.ru/"})))},showManagementPage:function(e,t,n,s,a,l){if(!(n>=9))return ui.go("https://"+window.location.host+"/messages");{a.hide();let e=document.createElement("div");e.classList=["card full_section"];let n=pages.elements.createInputField(settings.lang.getValue("chat_link"),!0).setType("text").setText("...").setReadOnly();e.appendChild(n),l.getJoinLink().then(function(e){n.setText(e)}).catch(function(e){});let i=!1,o=pages.elements.createButton("",settings.lang.getValue("update"),function(e){if(i)return;i=!0;let t=o.getElementsByClassName("collapsible-header")[0].getElementsByTagName("div")[0];t.innerText=settings.lang.getValue("loading"),l.updateJoinLink().then(function(e){n.setText(e),t.innerText=settings.lang.getValue("update"),i=!1}).catch(function(e){return t.innerText=settings.lang.getValue("update"),i=!1,unt.toast({html:settings.lang.getValue("upload_error")})})}),d=pages.chats.elements.permissionsWindow(t,function(e,n){if(void 0!==t[e]&&!(n<0||n>9))return l.setPermissions(e,n).then(function(e){}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})});s.appendChild(e),s.appendChild(o),s.appendChild(d),e.style.marginBottom=0,o.style.marginTop=0,unt.Collapsible.init(d)}},showUserManagementPage:function(e,t,n,s,a,l,i){a=pages.elements.menuBody();let o=pages.chats.elements.window(!1);l.hide(),o.getElementsByTagName("img")[0].src=e.photo_url,o.getElementsByTagName("img")[0].width=o.getElementsByTagName("img")[0].height=48;let d=o.getElementsByClassName("input-field")[0].parentNode;o.getElementsByClassName("input-field")[0].remove();let c=document.createElement("a");c.classList.add("alink-name"),d.appendChild(c);let u=document.createElement("b");if(c.appendChild(u),u.innerText=e.name||e.first_name+" "+e.last_name,e.account_type||(u.innerText=settings.lang.getValue("deleted_account"),o.getElementsByTagName("img")[0].src="https://dev.yunnet.ru/images/default.png"),c.href="user"===e.account_type?"/id"+e.user_id:"/bot"+e.bot_id,a.appendChild(o),ui.bindItems(),e.account_type){if(n>=s.can_change_levels&&n>e.chat_info.access_level){let t=pages.chats.elements.permissionsWindow({set_user_level:e.chat_info.access_level},function(t,n){return i.setUserLevel(e.user_id||-1*e.bot_id,n).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})},!0,n-1);a.appendChild(t),unt.Collapsible.init(t)}if(n>=s.can_mute&&n>e.chat_info.access_level){let t=pages.elements.createButton("",settings.lang.getValue(e.chat_info.is_muted?"unmute":"mute"),function(n){let s=t.getElementsByClassName("collapsible-header")[0].getElementsByTagName("div")[0],a=s.innerText;return s.innerText=settings.lang.getValue("loading"),s.style.color="gray",i.toggleWriteAccess(e.user_id||-1*e.bot_id).then(function(e){s.style.color="black",1===e&&(s.innerText=settings.lang.getValue("unmute")),0===e&&(s.innerText=settings.lang.getValue("mute"))}).catch(function(e){return s.innerText=a,s.style.color="black",unt.toast({html:settings.lang.getValue("upload_error")})})});a.appendChild(t)}}(n>=s.can_kick&&n>e.chat_info.access_level||e.chat_info.invited_by===settings.users.current.user_id&&n>e.chat_info.access_level)&&a.appendChild(pages.elements.createButton("",settings.lang.getValue("kick_user"),function(t){return pages.elements.confirm("",settings.lang.getValue("kick_confirmation"),function(t){if(t)return i.removeUser(e.user_id||-1*e.bot_id).then(function(e){return ui.go("https://"+window.location.host+"/messages?s="+i.peer_id+"&action=info")}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})})},"red"))},chat:{toggleChat:function(e,t,n){return t.getElementsByClassName("current_state")[0].innerText===settings.lang.getValue("leave_chat")?pages.elements.confirm("",settings.lang.getValue("leave_confirmation"),function(t){t&&e.toggleUser().then(function(t){return e.clearChatCache(),ui.go(window.location.href,!1,!1,!1,!1)}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})}):e.toggleUser().then(function(t){return e.clearChatCache(),ui.go(window.location.href,!1,!1,!1,!1)}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})},addMember:function(e){let t={subaction:"invite_user",to_chat:e.peer_id,chat:e,members:[]};return ui.go("https://"+window.location.host+"/friends",!1,!1,!1,!0,t)}},chatInfoCallback:function(e,t,n,s,a,l){s=pages.elements.menuBody();let i=e.metadata.permissions;e.metadata.permissions||(i={});let o=pages.chats.elements.window(!0);s.appendChild(o);let d=o.getElementsByTagName("input")[0];n<t.can_change_title||i.is_leaved||i.is_kicked?d.setAttribute("disabled","true"):(d.addEventListener("input",function(e){return d.value.isEmpty()||d.value.length>64?(o.getCreateButton().style.display="none",o.getCreateButton().classList.add("scale-out")):(o.getCreateButton().style.display="",o.getCreateButton().classList.remove("scale-out"))}),o.getCreateButton().addEventListener("click",function(e){return o.setLoading(!0),d.setAttribute("disabled","true"),l.setTitle(d.value).then(function(e){o.setLoading(!1),d.removeAttribute("disabled"),o.getCreateButton().style.display="none",o.getCreateButton().classList.add("scale-out")}).catch(function(e){return o.setLoading(!1),d.removeAttribute("disabled"),unt.toast({html:settings.lang.getValue("upload_error")})})})),n>=t.can_change_photo&&!i.is_leaved&&!i.is_kicked&&(o.getElementsByTagName("img")[0].onclick=function(){let e=pages.elements.fileUploader({onFileSelected:function(e,t,n){return n.setLoading(!0),uploads.getURL().then(function(e){return uploads.upload(e,t[0],function(e){return codes.callbacks.uploadResolve(e,n)}).then(function(e){let t="photo"+e.photo.owner_id+"_"+e.photo.id+"_"+e.photo.access_key;l.updatePhoto(t).then(function(e){n.close()}).catch(function(e){return n.close(),unt.toast({html:settings.lang.getValue("upload_error")})})}).catch(function(e){let t=settings.lang.getValue("upload_error");return unt.toast({html:t}),n.setLoading(!1)})}).catch(function(e){let t=settings.lang.getValue("upload_error");return unt.toast({html:t}),n.setLoading(!1)})},afterClose:function(){}});return e.addFooterItem(settings.lang.getValue("delete_a_photo"),function(t,n){return n.setLoading(!0),l.updatePhoto().then(function(t){e.close()}).catch(function(t){return e.close(),unt.toast({html:settings.lang.getValue("upload_error")})})}),e.open()}),o.getCreateButton().classList.add("scale-out"),o.getCreateButton().style.display="none",o.getElementsByTagName("input")[0].value=e.chat_info.data.title,o.getElementsByTagName("img")[0].src=e.chat_info.data.photo_url,a.hide();let c=[];i.is_kicked||(n>=t.can_invite&&!i.is_leaved&&c.push([settings.lang.getValue("invite_to_chat"),function(){return codes.callbacks.chat.addMember(l,u)}],"invite_to_chat"),i.is_leaved?c.push([settings.lang.getValue("return_to_chat"),function(){return codes.callbacks.chat.toggleChat(l,u,s)},"current_state"]):c.push([settings.lang.getValue("leave_chat"),function(){return codes.callbacks.chat.toggleChat(l,u,s)},"current_state"]));let u=pages.elements.actionsMenu(c,!1,!0,i.is_kicked||!1);if(s.appendChild(u),l.chatObject&&s.appendChild(pages.elements.createSwitchButton([[unt.Icon.NOTIFICATIONS,settings.lang.getValue("notifications"),function(){l.toggleNotifications().then(function(){e.metadata.notifications=!e.metadata.notifications})},e.metadata.notifications],[unt.Icon.MESSAGES,settings.lang.getValue("show_pinned_messages"),function(){l.togglePinnedMessages().then(function(){e.metadata.show_pinned_messages=!e.metadata.show_pinned_messages})},e.metadata.show_pinned_messages]])),i.is_kicked||unt.Collapsible.init(u),n>=9&&!i.is_kicked&&!i.is_leaved){let e=pages.elements.createButton(unt.Icon.SETTINGS,settings.lang.getValue("management"),function(e){return ui.go("https://"+window.location.host+"/messages?s="+l.peer_id.toString()+"&action=info&mode=management")});s.appendChild(e)}if(!i.is_kicked&&!i.is_leaved){let e=pages.elements.getLoader();s.appendChild(e);let i=document.createElement("div");i.classList=["card collection"],s.appendChild(i),i.style.display="none",ui.bindItems(),l.getMembers(1).then(function(o){o.forEach(function(e){let o=pages.elements.userItem(e);o.id=e.user_id||-1*e.bot_id;let d=o.getElementsByTagName("p")[0];if(e.chat_info.access_level>=9?d.innerText+=" ("+settings.lang.getValue("chat_creator")+")":settings.users.get(e.chat_info.invited_by).then(function(e){d.innerText+=" ("+settings.lang.getValue("invited_by").replace("(а)",2===e.gender?"а":"").replace("%by%",e.name||e.first_name+" "+e.last_name)+")"}).catch(function(e){d.innerText+=" ("+settings.lang.getValue("invited_by").replace("(а)",2===user.gender?"а":"").replace("%by%",settings.lang.getValue("deleted_account"))+")"}),(n>=t.can_kick||n>=t.can_mute)&&n>e.chat_info.access_level||e.chat_info.invited_by===settings.users.current.user_id&&n>e.chat_info.access_level){let t=document.createElement("div");t.classList.add("secondary-content");o.href;o.appendChild(t),o.href="";let n=document.createElement("div");t.appendChild(n),n.innerHTML=unt.Icon.EDIT,o.onclick=function(t){return t.preventDefault(),ui.go("https://"+window.location.host+"/messages?s="+l.peer_id+"&action=info&mode=edit",!1,!1,!1,!0,{userObject:e,menuBody:s,loader:a,chat:l})}}i.appendChild(o)}),e.hide(),i.style.display="",i.id="membersInfo",ui.bindItems()}).catch(function(t){return e.hide(),unt.toast({html:settings.lang.getValue("upload_error")})})}},messageCallback:function(e,t,n,s,a,l){if("A"===a.target.nodeName||"IMG"===a.target.nodeName)return;if(t.editMode)return;n.getElementsByClassName("reply")[0].disable(),n.getElementsByClassName("fwd")[0].disable();let i=Number(e.id),o=t.selectedMessages.indexOf(i);if(-1===o){if(t.selectedMessages.length>=100)return;t.selectedMessages.push(i),e.getElementsByClassName("msg")[0].classList.add("selected")}else t.selectedMessages.splice(o,1),e.getElementsByClassName("msg")[0].classList.remove("selected");s.style.display="none",n.style.display="",editHeader.style.display="none";let d=document.querySelectorAll(".selected"),c=!0;c=1===d.length&&!d[0].classList.contains("from-them"),e.sendError||e.isSending||(n.getElementsByClassName("reply")[0].enable(),n.getElementsByClassName("fwd")[0].enable(),c?n.getElementsByClassName("edit")[0].enable():n.getElementsByClassName("edit")[0].disable()),n.setText(t.selectedMessages.length+"/100"),t.selectedMessages.length<=0&&(n.style.display="none",s.style.display="",editHeader.style.display="none")},uploadResolve:function(e,t){let n=e.loaded/e.total*100;return t.setProgress(n)}}},subPages={searchFriends:function(e){let t={onlineOnly:!1,searchBots:!1,searchBotsOnly:!1},n=document.createElement("div");n.classList.add("card"),n.classList.add("full_section");let s=document.createElement("div");s.classList.add("valign-wrapper"),e.appendChild(n),n.appendChild(s);let a=pages.elements.createInputField(settings.lang.getValue("search_text"),!1).setType("text").maxLength(256);s.appendChild(a),a.style.margin=0,a.style.width="100%";let l=pages.elements.getLoader(),i=document.createElement("div");i.classList.add("card"),i.classList.add("collection");let o=!1;l.hide();let d=pages.elements.alertWindow(unt.Icon.SEARCH,settings.lang.getValue("no_results"),settings.lang.getValue("no_res").replace("%c%","0"));d.style.display="none";let c=pages.elements.createFAB(unt.Icon.SEARCH,function(){if(!o)return a.getInput().classList.remove("wrong"),a.getValue().isEmpty()?a.getInput().classList.add("wrong"):(o=!0,a.getInput().disabled=!0,c.getElementsByTagName("a")[0].classList.add("disabled"),l.show(),d.style.display="none",i.style.display="none",i.innerHTML="",settings.users.search(a.getValue(),t,0,30).then(function(e){return o=!1,a.getInput().disabled=!1,c.getElementsByTagName("a")[0].classList.remove("disabled"),e.length>0?(e.forEach(function(e){let t=pages.elements.userItem(e);i.appendChild(t)}),i.style.display=""):d.style.display="",ui.bindItems(),l.hide()}).catch(function(t){return o=!1,a.getInput().disabled=!1,c.getElementsByTagName("a")[0].classList.remove("disabled"),l.hide(),e.appendChild(pages.elements.uploadError())}))});c.style.marginLeft="15px",c.classList.remove("fixed-action-btn"),s.appendChild(c);let u=document.createElement("div");n.appendChild(u),u.innerHTML=unt.Icon.SETTINGS,u.style.cursor="pointer",u.style.marginTop="15px",u.style.width="fit-content",u.onclick=function(){if(o)return;let e=pages.elements.createWindow();e.getFooter().remove();let n=pages.elements.createChecker(settings.lang.getValue("online_only"),function(){return t.searchBotsOnly&&(t.searchBotsOnly=!1,a.setChecked(!1)),t.onlineOnly=!t.onlineOnly}).setChecked(t.onlineOnly),s=pages.elements.createChecker(settings.lang.getValue("search_bots"),function(){return t.searchBotsOnly&&(t.searchBotsOnly=!1,a.setChecked(!1)),t.searchBots=!t.searchBots}).setChecked(t.searchBots).setDisabled(!0),a=pages.elements.createChecker(settings.lang.getValue("search_bots_only"),function(){return t.searchBotsOnly||(t.searchBots=!1,t.onlineOnly=!1,n.setChecked(!1),s.setChecked(!1)),t.searchBotsOnly=!t.searchBotsOnly}).setChecked(t.searchBotsOnly);e.getContent().appendChild(n),e.getContent().appendChild(s),e.getContent().appendChild(a)},e.appendChild(i),e.appendChild(d),e.appendChild(l)},theming:function(e,t){e.appendChild(pages.elements.createSwitchButton([[unt.Icon.DEV,settings.lang.getValue("allow_js_themes"),function(e,t){if(settings.get().theming.js_allowed)return settings.get().theming.js_allowed=!1,t.checked=!1,themes.toggleJSState().then(function(e){return settings.get().theming.js_allowed=Boolean(e),t.checked=e}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})});{t.checked=!1;let e=pages.elements.createInputField(settings.lang.getValue("password"),!1).setType("password");pages.elements.confirm("",settings.lang.getValue("js_warning").replace("%username%",settings.users.current.first_name+" "+settings.users.current.last_name),function(n,s,a,l){return n?settings.users.verifyPassword(e.getValue()).then(function(n){return n?(e.getInput().classList.remove("wrong"),s.close(),themes.toggleJSState().then(function(e){return settings.get().theming.js_allowed=Boolean(e),t.checked=e}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})):e.getInput().classList.add("wrong")}):s.close()},!1).getBody().appendChild(e)}}]]).selectItem(0,settings.get().theming.js_allowed));let n=pages.elements.createCollapsible([[unt.Icon.EDIT,settings.lang.getValue("themer")]]),s=n.getBody(0),a=document.createElement("div");a.classList.add("collection");let l=["news","notifications","friends","messages","groups","archive","settings","audios"],i=pages.elements.createFAB(unt.Icon.ARROW_DOWN),o=pages.elements.createFAB(unt.Icon.ARROW_UP),d=pages.elements.createFAB(unt.Icon.SAVE);i.classList.remove("fixed-action-btn"),i.classList.add("scale-transition"),i.classList.add("scale-out"),o.classList.remove("fixed-action-btn"),o.classList.add("scale-transition"),o.classList.add("scale-out"),o.style.marginLeft="10px",d.classList.remove("fixed-action-btn"),d.classList.add("scale-transition"),d.classList.add("scale-out"),d.style.marginLeft="10px";let c=document.createElement("div");c.classList.add("valign-wrapper"),c.style.marginTop="10px",c.appendChild(i),c.appendChild(o),c.appendChild(d),o.mode=0,i.mode=1,settings.get().theming.menu_items.forEach(function(e){if(!l[e-1])return;let t=document.createElement("a");return t.itemId=e,t.classList.add("collection-item"),t.innerText=settings.lang.getValue(l[e-1]),t.onclick=function(n){a.querySelectorAll(".selected").forEach(function(t){e!==t.itemId&&(t.classList.remove("selected"),t.classList.remove("active"))}),t.classList.contains("selected")?(t.classList.remove("selected"),t.classList.remove("active"),o.classList.add("scale-out"),i.classList.add("scale-out")):(t.classList.add("selected"),t.classList.add("active"),o.classList.remove("scale-out"),i.classList.remove("scale-out"))},a.appendChild(t)}),i.onclick=o.onclick=function(e){let t=a.getElementsByClassName("selected")[0];if(!t)return;let n=a.getElementsByTagName("a");for(let e=0;e<n.length;e++){if(n[e].itemId===t.itemId){let s=n[1===this.mode?e+1:e-1];if(s){t.remove(),s.insertAdjacentElement(1===this.mode?"afterend":"beforebegin",t);break}}}let s=[];for(let e=0;e<n.length;e++)s.push(n[e].itemId);let l=!1;for(let e=0;e<s.length;e++)if(s[e]!==settings.get().theming.menu_items[e]){l=!0;break}l?d.classList.remove("scale-out"):d.classList.add("scale-out")},d.onclick=function(){let e=a.getElementsByTagName("a"),t=[];for(let n=0;n<e.length;n++)t.push(e[n].itemId);let n=!1;for(let e=0;e<t.length;e++)if(t[e]!==settings.get().theming.menu_items[e]){n=!0;break}if(n)return themes.menu.updateItems(t).then(function(e){if(e)return window.location.reload()}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})},s.appendChild(a),s.appendChild(c),e.appendChild(n),e.appendChild(pages.elements.createButton(unt.Icon.PALETTE,settings.lang.getValue("account_themes"),function(e){return ui.go("https://"+window.location.host+"/themes")}))},audios:{manage:function(e,t,n,s,a,l){a.hide();if("audios"===e)return s.appendChild(pages.elements.alertWindow(unt.Icon.LOCKED,settings.lang.getValue("in_development"),settings.lang.getValue("audios_in_dev")));if("vk_audios"===e){s.appendChild(pages.elements.createButton(unt.Icon.INFO,settings.lang.getValue("logged_as")+": "+l[0].first_name+" "+l[0].last_name,new Function));let e,t=audios.buildPlayerElement(!1),n=!1;s.onscroll=function(e){n||window.scrollY===document.body.scrollHeight-document.body.offsetHeight&&(n=!0)},audios.miniPlayerCreated||((e=audios.buildPlayerElement(!0)).style.display="none",e.setup()),audios.current||(t.style.display="none"),s.appendChild(t);let a=document.createElement("div");a.classList.add("card"),a.classList.add("collection"),s.appendChild(a);let i=pages.elements.getLoader();s.appendChild(i),a.style.display="none",function(l=1){i.show(),audios.get(1,l).then(function(o){return o.length>0?(o.forEach(function(n){let s=pages.elements.audioItem(n,t,e);return a.appendChild(s)}),a.style.display=""):1===l&&s.appendChild(pages.elements.alertWindow(unt.Icon.AUDIO_OFF,settings.lang.getValue("no_audio"),settings.lang.getValue("no_audio_text"))),n=!1,i.hide()}).catch(function(e){let t=pages.elements.uploadError();return i.hide(),s.appendChild(t)})}()}}},accounts:{VKManage:function(e,t,n){let s=document.createElement("div");s.classList.add("modal"),ui.isMobile()&&s.classList.add("bottom-sheet");let a=document.createElement("div");a.classList.add("modal-content"),s.appendChild(a);let l=document.createElement("div");if(l.classList.add("modal-footer"),s.appendChild(l),n.appendChild(s),unt.Modal.init(s).open(),e.bound){l.remove();let e=document.createElement("div");e.classList.add("collection"),a.appendChild(e);let t=document.createElement("a");t.classList.add("collection-item"),t.innerText=settings.lang.getValue("logout"),e.appendChild(t),t.onclick=function(){return pages.elements.confirm("",settings.lang.getValue("logout_qq"),function(e){if(e)return settings.accounts.unbound(1).then(function(e){return ui.go(window.location.href,!1,!0)})})}}else{let e=document.createElement("form");e.method="POST",e.innerText=settings.lang.getValue("logstart"),a.appendChild(e);let t=pages.elements.createInputField(settings.lang.getValue("login")).setType("text"),n=pages.elements.createInputField(settings.lang.getValue("password")).setType("password");a.appendChild(t),a.appendChild(n);let i=document.createElement("a");i.action="submit",e.onsubmit=function(e){return e.preventDefault()},i.classList=["disabled btn-flat waves-effect"],i.innerText=settings.lang.getValue("continue"),l.appendChild(i),t.getInput().oninput=n.getInput().oninput=function(e){t.getValue().isEmpty()||n.getValue().isEmpty()?i.classList.add("disabled"):i.classList.remove("disabled")},i.onclick=function(){return i.classList.add("disabled"),t.getInput().classList.add("disabled"),n.getInput().classList.add("disabled"),settings.accounts.auth(t.getValue(),n.getValue(),1).then(function(e){if(i.classList.remove("disabled"),t.getInput().classList.remove("disabled"),n.getInput().classList.remove("disabled"),5===e.error)return unt.toast({html:settings.lang.getValue("incorrect_login")});if(10===e.error||20===e.error){20===e.error&&unt.toast({html:settings.lang.getValue("vk_limits")});let s=t.getValue(),l=n.getValue();a.innerHTML="";let o=pages.elements.createInputField(settings.lang.getValue("code")).setType("number");a.appendChild(o),i.classList.remove("disabled"),o.getInput().oninput=function(){if(o.getValue().isEmpty())return i.classList.add("disabled");i.classList.remove("disabled")},i.onclick=function(){return i.classList.add("disabled"),settings.accounts.auth(s,l,1,o.getValue()).then(function(e){return i.classList.remove("disabled"),5===e.error?unt.toast({html:settings.lang.getValue("wrong_code")}):ui.go(window.location.href,!1,!0)})}}return e.success?(unt.Modal.getInstance(s).close(),ui.go(window.location.href,!1,!0)):void 0}).catch(function(e){return i.classList.remove("disabled"),t.getInput().classList.remove("disabled"),n.getInput().classList.remove("disabled"),unt.toast({html:settings.lang.getValue("upload_error")})})}}}},themes:{installed:function(e,t,n){if("edit"===t.mode&&n&&n.theme&&n.theme.owner_id===settings.users.current.user_id)return subPages.themes.editTheme(e,n);document.title="yunNet. - "+settings.lang.getValue("installed_themes"),ui.isMobile()&&(nav_header_title.innerText=settings.lang.getValue("installed_themes"));let s=pages.elements.getLoader();s.style.marginTop="10px",e.appendChild(s);let a=document.createElement("div");return a.classList.add("card"),a.classList.add("collection"),e.appendChild(a),a.style.display="none",e.appendChild(pages.elements.createFAB(unt.Icon.EDIT,null,[[unt.Icon.ADD,function(){let e=pages.elements.createWindow(),t=e.getFooter(),n=e.getContent(),s=document.createElement("div");n.appendChild(s),s.innerText=settings.lang.getValue("create_theme")+":";let a=document.createElement("a");a.classList.add("btn-flat"),a.classList.add("waves-effect"),a.innerText=settings.lang.getValue("continue"),t.appendChild(a),n.appendChild(document.createElement("br"));let l=pages.elements.createInputField(settings.lang.getValue("theme_title"),!1).setType("text").maxLength(64);n.appendChild(l);let i=pages.elements.createInputField(settings.lang.getValue("desc"),!1).setType("text").maxLength(128);n.appendChild(i);let o=pages.elements.createChecker(settings.lang.getValue("private_theme"),function(){return!0});n.appendChild(o),a.onclick=function(){return l.getInput().classList.remove("wrong"),i.getInput().classList.remove("wrong"),l.getValue().trim().isEmpty()?l.getInput().classList.add("wrong"):i.getValue().trim().isEmpty()?i.getInput().classList.add("wrong"):(a.classList.add("disabled"),l.getInput().setAttribute("disabled",""),i.getInput().setAttribute("disabled",""),o.setDisabled(!0),themes.create(l.getValue().trim(),i.getValue().trim(),o.checked()).then(function(t){return e.getInstance().close(),ui.go(window.location.href,!1,!0,!1,!0)}).catch(function(e){return a.classList.remove("disabled"),l.getInput().removeAttribute("disabled"),i.getInput().removeAttribute("disabled"),o.setDisabled(!1),unt.toast({html:settings.lang.getValue("upload_error")})}))}}],[unt.Icon.EXPORT,function(){return pages.elements.fileUploader({onFileSelected:function(e,t,n){return n.setLoading(!0),uploads.getURL(uploads.type.THEME).then(function(e){return uploads.upload(e,t[0],function(e){return codes.callbacks.uploadResolve(e,n)}).then(function(e){return n.setLoading(!1),n.close(),ui.go(window.location.href)}).catch(function(e){let t=settings.lang.getValue("upload_error");return unt.toast({html:t}),n.setLoading(!1)})}).catch(function(e){let t=settings.lang.getValue("upload_error");return unt.toast({html:t}),n.setLoading(!1)})},afterClose:function(){},fileTypes:".uth"}).open()}]])),themes.get(1,30).then(function(e){return a.appendChild(pages.elements.theme()),e.forEach(function(e){return a.appendChild(pages.elements.theme(e))}),s.hide(),a.style.display=""}).catch(function(t){let n=pages.elements.uploadError();return s.hide(),e.appendChild(n)})},repo:function(e){document.title="yunNet. - "+settings.lang.getValue("theme_repos"),ui.isMobile()&&(nav_header_title.innerText=settings.lang.getValue("theme_repos"))},editTheme:function(e,t){document.title="yunNet. - "+settings.lang.getValue("edit_theme"),ui.isMobile()&&(nav_header_title.innerText=settings.lang.getValue("edit_theme"));let n=document.createElement("div");n.classList.add("card"),n.classList.add("full_section"),e.appendChild(n);let s=pages.elements.createInputField(settings.lang.getValue("theme_title"),!0).setType("text").maxLength(64);n.appendChild(s),s.getInput().value=t.theme.data.title;let a=pages.elements.createInputField(settings.lang.getValue("desc"),!0).setType("text").maxLength(128);n.appendChild(a),a.getInput().value=t.theme.data.description;let l=pages.elements.createChecker(settings.lang.getValue("private_theme"),function(){return!0}).setChecked(t.theme.settings.is_private);n.appendChild(l),t.theme.settings.is_default&&l.setDisabled(!0);let i=pages.elements.getLoader(),o=pages.elements.createFAB(unt.Icon.SAVE,function(e){return s.getInput().classList.remove("wrong"),a.getInput().classList.remove("wrong"),s.getValue().isEmpty()||s.getValue().length>64?s.getInput().classList.add("wrong"):a.getValue().isEmpty()||a.getValue().length>128?s.getInput().classList.add("wrong"):(o.style.display="none",i.style.display="",l.setDisabled(!0),s.setDisabled(!0),a.setDisabled(!0),themes.data.update(settings.users.current.user_id,t.theme.id,s.getValue().trim(),a.getValue().trim(),l.checked()).then(function(e){return o.style.display="",i.style.display="none",t.theme.settings.is_default||l.setDisabled(!1),s.setDisabled(!1),a.setDisabled(!1),unt.toast({html:settings.lang.getValue("saved")})}).catch(function(e){return o.style.display="",i.style.display="none",t.theme.settings.is_default||l.setDisabled(!1),s.setDisabled(!1),a.setDisabled(!1),unt.toast({html:settings.lang.getValue("upload_error")})}))});o.style.textAlign="end",i.style.display="none",i.style.textAlign="end",o.classList.remove("fixed-action-btn"),i.classList.remove("center"),n.appendChild(o),n.appendChild(i);let d=pages.elements.createButton(null,null,null,null,[[unt.Icon.PALETTE,settings.lang.getValue("edit_css"),function(){return pages.elements.loadingMode(),themes.data.getCode(t.theme.owner_id,t.theme.id,"css").then(function(e){pages.elements.loadingMode().getInstance().close();let n=themes.codeEditor.build();return n.getUpPanel().addButton(unt.Icon.DOWNLOAD,function(e,n){return n.setLoading(!0),themes.data.export(t.theme.owner_id,t.theme.id).then(function(){n.setLoading(!1)}).catch(function(e){return n.setLoading(!1),unt.toast({html:settings.lang.getValue("upload_error")})})},35),n.getUpPanel().addButton(unt.Icon.SAVE,function(e,s){s.setLoading(!0);let a=n.getCurrentCode();return themes.data.code.update(t.theme.owner_id,t.theme.id,"css",a).then(function(e){return s.setLoading(!1),unt.toast({html:settings.lang.getValue("saved")})}).catch(function(e){s.setLoading(!1);let t=settings.lang.getValue("upload_error");return e.errorMessage&&(t=e.errorMessage),unt.toast({html:t})})},0),n.getDownPanel().addButton(unt.Icon.SETTINGS,function(e,t){}),n.getDownPanel().addButton(unt.Icon.PICTURE,function(e,t){return pages.elements.fileUploader({onFileSelected:function(e,t,n){return n.setLoading(!0),uploads.getURL(uploads.type.IMAGE).then(function(e){return uploads.upload(e,t[0],function(e){return codes.callbacks.uploadResolve(e,n)}).then(function(e){n.setLoading(!1),n.close();let t=e.photo.url.main,s=pages.elements.createWindow(),a=s.getContent();s.getFooter().remove();let l=document.createElement("div");a.appendChild(l),l.innerText=settings.lang.getValue("insert_into_code");let i=document.createElement("div");a.appendChild(i),i.style.marginTop="15px";let o=document.createElement("textarea");o.setAttribute("readonly","true"),o.classList.add("materialize-textarea"),i.appendChild(o),o.innerText="--unt-user-background: url("+t+");",unt.updateTextFields(),unt.textareaAutoResize(o)}).catch(function(e){let t=settings.lang.getValue("upload_error");return unt.toast({html:t}),n.setLoading(!1)})}).catch(function(e){let t=settings.lang.getValue("upload_error");return unt.toast({html:t}),n.setLoading(!1)})},afterClose:function(){}}).open()}),document.body.insertAdjacentElement("afterbegin",n.setTitle(t.theme.data.title+" (CSS)").setCode(e))}).catch(function(e){return pages.elements.loadingMode().getInstance().close(),unt.toast({html:settings.lang.getValue("upload_error")})})}],[unt.Icon.DEV,settings.lang.getValue("edit_js"),function(){return pages.elements.loadingMode(),settings.get().theming.js_allowed?themes.data.getCode(t.theme.owner_id,t.theme.id,"js").then(function(e){pages.elements.loadingMode().getInstance().close();let n=themes.codeEditor.build();return n.getUpPanel().addButton(unt.Icon.DOWNLOAD,function(e,n){return themes.data.export(t.theme.owner_id,t.theme.id).then(function(){n.setLoading(!1)}).catch(function(e){return n.setLoading(!1),unt.toast({html:settings.lang.getValue("upload_error")})})},35),n.getUpPanel().addButton(unt.Icon.SAVE,function(e,s){s.setLoading(!0);let a=n.getCurrentCode();return themes.data.code.update(t.theme.owner_id,t.theme.id,"js",a).then(function(e){return s.setLoading(!1),unt.toast({html:settings.lang.getValue("saved")})}).catch(function(e){s.setLoading(!1);let t=settings.lang.getValue("upload_error");return e.errorMessage&&(t=e.errorMessage),unt.toast({html:t})})},0),n.getDownPanel().addButton(unt.Icon.SETTINGS,function(e,t){}),document.body.insertAdjacentElement("afterbegin",n.setTitle(t.theme.data.title+" (JS)").setCode(e))}).catch(function(e){return pages.elements.loadingMode().getInstance().close(),unt.toast({html:settings.lang.getValue("upload_error")})}):(pages.elements.loadingMode().getInstance().close(),unt.toast({html:settings.lang.getValue("enable_themes_js")}))}]]),c=pages.elements.createButton(unt.Icon.DOWNLOAD,settings.lang.getValue("export_theme"),function(){return pages.elements.loadingMode(),themes.data.export(t.theme.owner_id,t.theme.id).then(function(){return pages.elements.loadingMode().getInstance().close()}).catch(function(e){return unt.toast({html:settings.lang.getValue("upload_error")})})});e.appendChild(d),e.appendChild(c)}}};
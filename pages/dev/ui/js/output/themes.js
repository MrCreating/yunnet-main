const photos={show:function(e,t){let n=e.src,r=document.createElement("div");r.classList.add("image-view"),r.style.background="#101010",r.style.position="fixed",r.style.zIndex=1046,r.style.left=r.style.right=r.style.bottom=r.style.top=0,document.body.appendChild(r);let i=document.createElement("div");r.appendChild(i),i.style.width="100%",i.style.height="100%";let a=document.createElement("div");a.style.width="100%",a.style.padding="15px",a.style.zIndex=1,a.style.position="absolute",a.style.top=0,a.style.background="linear-gradient(black, transparent)";let l=document.createElement("a");a.appendChild(l),l.innerHTML=unt.Icon.CLOSE,l.getElementsByTagName("svg")[0].style.fill="white",i.appendChild(a),l.href="#",l.onclick=function(e){e.preventDefault(),r.remove()},a.classList.add("valign-wrapper");let s=e.getAttribute("attachment").split("photo")[1].split("_"),o=document.createElement("a");o.classList.add("valign-wrapper"),o.style.marginBottom="5px",o.style.marginLeft="10px",a.appendChild(o);let d=document.createElement("div"),u=document.createElement("img");u.classList.add("circle"),u.width=u.height=24,u.alt="",d.appendChild(u),o.appendChild(d);let c=document.createElement("div");o.appendChild(c),c.style.marginLeft="10px",c.innerText="...",c.style.color="white";let p=pages.elements.getLoader();p.style="position: absolute; top: 50%; left: 50%; margin-right: -50%; transform: translate(-50%, -50%);",p.getElementsByTagName("path")[0].style.fill="white",i.appendChild(p);let m=document.createElement("img");m.src=n;let h=document.createElement("div");i.appendChild(h),h.style="position: absolute; top: 50%; left: 50%; margin-right: -50%; transform: translate(-50%, -50%); display: none; text-align: -webkit-center",m.style.width=m.style.height="100%",m.onload=function(){p.remove(),h.style.display="";let e=document.createElement("div");h.appendChild(e),e.style.position="relative",e.style.top=0,e.style.maxWidth="70%",e.appendChild(m);var t=1,n=!1,r=0,i=0,a={x:0,y:0},l=m;function s(){l.style.transform="translate("+r+"px, "+i+"px) scale("+t+")"}m.ondblclick=function(e){n=!n,e.preventDefault(),n?(a={x:e.clientX-r,y:e.clientY-i},r=e.clientX-a.x,i=e.clientY-a.y,t=2,s()):(a={x:0,y:0},t=1,n=!1,r=0,i=0,l.style.transform="")},l.onmousemove=function(e){e.preventDefault(),n&&m.pressed&&(r=e.clientX-a.x,i=e.clientY-a.y,s())},l.onwheel=function(e){e.preventDefault();var n=(e.clientX-r)/t,a=(e.clientY-i)/t;(e.wheelDelta?e.wheelDelta:-e.deltaY)>0?t*=1.2:t/=1.2,r=e.clientX-n*t,i=e.clientY-a*t,s()},m.onmousedown=function(e){n&&(m.pressed=!0)},h.onmouseup=function(e){n&&(m.pressed=!1)},m.ondragstart=function(e){return e.preventDefault()},m.ondragend=function(e){return e.preventDefault()}},m.onerror=function(){return p.remove()},o.href="/id"+s[0],o.target="_blank";let y=document.createElement("div");y.style.width="100%",y.style.padding="15px",y.style.background="linear-gradient(transparent, black)",y.style.position="absolute",y.style.zIndex=1,y.style.bottom=0,i.appendChild(y);let f=document.createElement("div");f.classList.add("valign-wrapper"),y.appendChild(f);let g=document.createElement("div"),w=document.createElement("div");return f.appendChild(g),f.appendChild(w),g.innerHTML=unt.Icon.LIKE,w.innerHTML=unt.Icon.LIKE_SET,g.getElementsByTagName("path")[1].style="stroke: white !important",w.getElementsByTagName("svg")[0].style.display="",g.style.display="",w.style.display="none",photos.getByCredentials(e.getAttribute("attachment")).then(function(t){t.photo&&t.photo.meta.likes.liked_by_me?(g.style.display="none",w.style.display=""):(g.style.display="",w.style.display="none");let n=document.createElement("div");f.appendChild(n),n.innerText=t.photo.meta.likes.count>0?pages.parsers.niceString(t.photo.meta.likes.count):"",n.style.marginLeft="10px",n.style.marginBottom="7px",n.style.color="white",g.onclick=w.onclick=function(t){return photos.like(e.getAttribute("attachment")).then(function(e){n.innerText=e.new_count>0?pages.parsers.niceString(e.new_count):"",0===e.state?(g.style.display="",w.style.display="none"):(g.style.display="none",w.style.display="")}).catch(function(e){})}}).catch(function(e){g.style.display="none",w.style.display="none"}),settings.users.get(Number(s[0])).then(function(e){u.src=e.photo_url,c.innerText="bot"===e.account_type?e.name:e.first_name+" "+e.last_name}).catch(function(e){return p.remove(),o.remove()})},like:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","like_photo"),ui.Request({data:r,url:"/"+e,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n("Unable to change like state of photo"):t(e.response)}})})},getByCredentials:function(e){return new Promise(function(t,n){let r=new FormData;return r.append("action","get_attachment_info"),r.append("credentials",e),ui.Request({url:"/flex",data:r,method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Unable to find or fetch attachment object")):t(e.attachment)}})})}},themes={data:{export:function(e,t){return new Promise(function(n,r){if(e!==settings.users.current.user_id)return r(new TypeError("You can not export this theme."));let i=document.createElement("a");i.style.display="none",i.href="https://themes.yunnet.ru/theme"+Number(e)+"_"+Number(t)+"?mode=export",i.download="theme"+Number(e)+"_"+Number(t)+".uth",document.body.appendChild(i),i.onclick=function(){return n(!0)},setTimeout(function(){return i.click(),i.remove()},2e3)})},code:{update:function(e,t,n="css",r=""){return"js"!==n&&(n="css"),new Promise(function(i,a){let l=new FormData;return l.append("action","update_theme_code"),l.append("theme_id",Number(t)||0),l.append("owner_id",Number(e)||settings.users.current.user_id),l.append("code_type",String(n)),l.append("new_code",String(r).trim()),ui.Request({url:"/themes",data:l,method:"POST",success:function(e){if((e=JSON.parse(e)).error){let t=new Error("Unable to update theme");return e.message&&(t.errorMessage=e.message),a(t)}return i(e.success)}})})}},getCode:function(e,t,n="css"){return"js"!==n&&(n="css"),new Promise(function(r,i){let a=_xmlHttpGet();return a.open("GET","https://themes.yunnet.ru/theme"+Number(e)+"_"+Number(t)+"?mode="+n),a.onreadystatechange=function(){if(4!==a.readyState)return;let e=a.responseText;if("[]"===e)return i(new Error("Theme code not found"));try{return(e=JSON.parse(e)).error?i(new Error("Unable to receive code")):i(new Error("Fetch failed"))}catch(t){return r(e)}},a.withCredentials=!0,a.send()})},update:function(e,t,n="",r="",i=0){return new Promise(function(a,l){let s=new FormData;return s.append("action","update_theme_info"),s.append("theme_id",Number(t)||0),s.append("owner_id",Number(e)||settings.users.current.user_id),!n.isEmpty()&&n.length<=64&&s.append("new_title",n),!r.isEmpty()&&r.length<=128&&s.append("new_description",r),s.append("private_mode",Number(Boolean(Number(i)))),ui.Request({data:s,url:"/themes",method:"POST",success:function(e){return(e=JSON.parse(e)).error?l(new TypeError("Unable to update theme!")):a(e.success)}})})}},create:function(e,t,n=0){return new Promise(function(r,i){let a=new FormData;return a.append("action","create_theme"),a.append("theme_title",String(e)),a.append("theme_description",String(t)),a.append("is_private",Number(n)),ui.Request({url:"/themes",data:a,method:"POST",success:function(e){return(e=JSON.parse(e)).error?i(new TypeError("Unable to create the theme")):r(e)}})})},delete:function(e,t){return new Promise(function(n,r){let i=new FormData;return i.append("action","delete_theme"),i.append("owner_id",Number(e)),i.append("theme_id",Number(t)),ui.Request({data:i,method:"POST",url:"/themes",success:function(e){return(e=JSON.parse(e)).error?r(new TypeError("Unable to delete the theme")):n(e.success)}})})},setup:function(e=null){return new Promise(function(t,n){let r=document.getElementById("themeCSS");if(r&&r.remove(),e){let n=_xmlHttpGet();return n.onreadystatechange=function(){if(4===n.readyState)try{let e=JSON.parse(n.responseText);if(!e||e.error)return null;let r=e.data.url;if(r&&e.params.has_css){let e=document.createElement("link");e.id="themeCSS",e.type="text/css",e.rel="stylesheet",e.media="screen,projection",e.href=r+"?mode=css",e.onload=function(){return t()},document.head.appendChild(e)}}catch(e){return t()}},n.open("GET","https://themes.yunnet.ru/"+e),n.send()}return t()})},apply:function(e,t=!0){return new Promise(function(){let n=new FormData;return t||"theme1_1"!==e?t||null!==e?(e?(n.append("action","apply_theme"),n.append("credentials",e)):n.append("action","reset_theme"),ui.Request({url:"/themes",method:"POST",data:n,success:function(t){return ui.go(window.location.href,!0,!0,{}),settings.get().theming.current_theme=e}})):window.location.reload():realtime.handler({event:"interface_event",data:{action:"theme_changed",theme:{owner_id:1,id:1,data:{title:"Dark theme",description:"yunNet dark theme",url:"https://themes.yunnet.ru/theme1_1"},params:{has_api:!1,has_css:!0,has_js:!0},settings:{is_default:1,is_private:0}}},last_event_id:realtime.lastEventId},realtime.handler)})},get:function(e=1,t=30){return new Promise(function(n,r){let i=new FormData;return i.append("action","get_themes"),i.append("offset",e*t-t),i.append("count",Number(t)||30),ui.Request({url:"/themes",method:"POST",data:i,success:function(e){return(e=JSON.parse(e)).error?r(new TypeError("Themes fetch failed")):n(e.response)}})})},toggleJSState:function(){return new Promise(function(e,t){let n=new FormData;return n.append("action","toggle_js_state"),ui.Request({data:n,method:"POST",url:"/settings",success:function(n){return(n=JSON.parse(n)).error?t(new TypeError("JS state changing error")):e(n.state)}})})},menu:{updateItems:function(e=[1,2,3,4,5,6]){return new Promise(function(t,n){let r=new FormData;return r.append("action","update_menu_items"),r.append("items",e.join()),ui.Request({data:r,url:"/settings",method:"POST",success:function(e){return(e=JSON.parse(e)).error?n(new TypeError("Unable to update menu items")):t(Boolean(e.success))}})})}},codeEditor:{build:function(){let e=document.title,t=document.createElement("div");t.classList.add("code-editor"),t.style.backgroundColor="#282923",t.style.position="fixed",t.style.zIndex=1024,t.style.inset="0px",t.style.width=t.style.height="100%";let n=document.createElement("div");t.appendChild(n),n.style.width=n.style.height="100%";let r=document.createElement("div");r.style.width="100%",r.style.padding="15px",r.style.background="#212121",r.style.position="absolute",r.style.zIndex=1,r.style.top=0;let i=document.createElement("div");i.style.width="100%",i.style.padding="15px",i.style.background="#212121",i.style.position="absolute",i.style.zIndex=1,i.style.bottom=0;let a=document.createElement("div");n.appendChild(r),n.appendChild(a),n.appendChild(i);let l=document.createElement("div");l.classList.add("valign-wrapper"),r.appendChild(l);let s=document.createElement("div");s.classList.add("valign-wrapper"),s.style.height="25px",i.appendChild(s);let o=document.createElement("a");o.href="#",l.appendChild(o),o.innerHTML=unt.Icon.CLOSE,o.getElementsByTagName("svg")[0].style.fill="white",o.onclick=function(e){return e.preventDefault(),t.close()};let d=document.createElement("div");l.appendChild(d),d.style.color="white",d.style.marginBottom="6px",d.style.marginLeft="15px",t.getCurrentCode=function(){return c.innerText},t.getUpPanel=function(){return l},t.getDownPanel=function(){return s},l.addButton=function(e,n=null,r=-1){let i=document.createElement("div"),a=document.createElement("a");i.style.cursor="pointer",l.appendChild(i),i.appendChild(a),a.innerHTML=e,a.getElementsByTagName("svg")[0].style.fill="white",i.style.position="absolute",i.style.padding="15px",r>=0&&(i.style.right=r+"px"),a.onclick=function(e){if(n)return n(e,a)};let s=pages.elements.getLoader();return i.appendChild(s),s.style.display="none",s.setArea(22),a.setLoading=function(e){return e?(a.style.display="none",s.style.display=""):(a.style.display="",s.style.display="none"),a},t},s.addButton=function(e,n=null,r=-1){let i=document.createElement("div"),a=document.createElement("a");i.style.cursor="pointer",s.appendChild(i),i.appendChild(a),a.innerHTML=e,a.getElementsByTagName("svg")[0].style.fill="white",r>0&&(i.style.position="absolute"),i.style.paddingRight="15px",r>=0&&(i.style.right=r+"px"),a.onclick=function(e){if(n)return n(e,a)};let l=pages.elements.getLoader();return i.appendChild(l),l.style.display="none",l.setArea(22),a.setLoading=function(e){return e?(a.style.display="none",l.style.display=""):(a.style.display="",l.style.display="none"),a},t},t.setTitle=function(e){return!!e&&("string"==typeof e&&(!(e.isEmpty()||e.length>128)&&(d.innerText=String(e),document.title=e,t)))},t.close=function(){return t.remove(),document.title=e,t},a.classList.add("full_section"),a.style.marginTop="59px",a.style.width="100%",a.style.height="calc(100% - 115px)",a.style.overflow="auto";let u=document.createElement("pre");a.appendChild(u);let c=document.createElement("code");c.setAttribute("contenteditable","true");let p=document.createElement("div");return c.appendChild(p),p.innerText="\r",u.appendChild(c),c.onkeydown=function(e){let t=e.keyCode||e.which;if(0===c.getElementsByTagName("div").length){c.innerHTML="";let e=document.createElement("div");c.appendChild(e),e.innerText="\r"}if(8===t&&c.innerText.length<=1&&(e.preventDefault(),!c.innerText.isEmpty()||" "===c.innerText||"\n"===c.innerText||""===c.innerText)){c.innerHTML="";let e=document.createElement("div");c.appendChild(e),e.innerText="\r"}9===t&&(e.preventDefault(),document.execCommand("insertText",!1," ".repeat(4)))},t.setCode=function(e){return c.innerHTML="",String(e).split("\n").forEach(function(e){let t=document.createElement("div");c.appendChild(t),t.innerText=e}),t},c.style.color="white",c.style.outlineWidth=0,t}}};